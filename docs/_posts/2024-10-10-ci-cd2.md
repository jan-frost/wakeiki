---
title: "Continuous Integration and Continuous Deployment: Refining Our Setup"
date: 2024-10-12
categories: [development, ci-cd, automation, elm, android]
---

Today, I focused on refining our CI/CD setup, particularly on implementing elm-format as a pre-commit hook. This approach ensures that our Elm code is consistently formatted before it even reaches our repository.

## Setting Up elm-format as a Pre-commit Hook

To achieve this, we're using Husky and lint-staged. These tools allow us to run scripts (in our case, elm-format) on staged files before they're committed. Here's how we set it up:

1. We added Husky and lint-staged as dev dependencies in our `package.json` file.
2. We configured lint-staged to run elm-format on all staged `.elm` files.
3. We added a `prepare` script to install Husky hooks.

Here's the relevant part of our updated `package.json`:

```json
{
  "scripts": {
    "prepare": "cd .. && husky install wakeiti-app/.husky"
  },
"devDependencies": {
"husky": "^8.0.0",
"lint-staged": "^15.2.10"
},
"lint-staged": {
    ".elm": "elm-format --yes"
  }
}
```

## Lessons Learned

During this process, I made some interesting observations:

1. **Context Matters**: I noticed that the AI assistant's suggestions can vary significantly based on the context provided. For example, when I didn't include the `package.json` file in the context, the assistant's suggestion removed many existing entries when adding Husky. This highlights the importance of providing comprehensive context when seeking advice or generating code.

2. **Version Awareness**: The AI often suggests older versions of packages. While this isn't necessarily a problem, it's something to be aware of. Always check for the latest stable versions of packages when implementing suggestions.

3. **Alignment of Ideas**: Interestingly, the AI suggested setting up elm-format as a pre-commit hook while I was typing my intention to do so. It's reassuring when the AI's suggestions align with your own plans, as it can validate your approach.

> Meta comment here: I really like this lessons learned part. It was actually something I stubbed out in this blog post before asking the AI to write it. It changed the order of the blog post section, which I think is better.
>
> On the downside, it keeps suggesting "next steps". That might be a blog-thing, but the things it suggests are not at all the things I want to do next. No, I don't need any additional pre-commit hooks and I have already updates the CI/CD pipeline.